{% extends 'main.html' %}

{% block title %}SocialFeed{% endblock %}


{% block content %}
    <div class="text-center my-3">
        <h3>Hi, {{ request.user }}</h3>
    </div>

    <div class='bg-light py-2'>
        <div class="text-center">
            <form action="" method="POST">
                {{ post_form.post_text }}
                {% csrf_token %}
                <input type="submit" value="Post">
            </form>
        </div>

        {% for post in posts %}
            <div class="col-md-10 text-left bg-white rounded my-3 py-1 mx-auto">
                <div class='col-md-1'>
                    <a class="text-decoration-none stretched-link" href="{% url 'Accounts:profile_view' username=post.user %}">
                        <h3>{{ post.user }}</h3>
                    </a>
                </div>
                {{ post.post_text }}<br>
                <hr>

                <div class='small d-flex'>
                    <form action="{% url 'Posts:like_post' post.id %}" method='POST'>
                        {% csrf_token %}
                        {% if request.user not in post.users_like.all %}
                        <button type='submit' name='post_id' value={{post.id}} class="btn btn-primary btn-sm mr-2">Like</button>
                        {% else %}
                        <button type='submit' name='post_id' value={{post.id}} class="btn btn-primary btn-sm mr-2">Unlike</button>
                        {% endif %}
                    </form>
                        <p class="mr-2">Total likes: {{ post.total_likes }}</p>
                    <a href="{% url 'Posts:post_view' post.user post.id post.slug %}" class="text-right mr-2">View post</a>
                    {% if request.user == post.user %}
                        <a href="{% url 'Posts:delete_post' pk=post.id %}" class="mr-2">remove</a>
                        <a href="{% url 'Posts:edit_post' pk=post.id %}" class="mr-2">edit</a>
                    {% endif %}
                    <p class="mr-2">Published: {{post.created_date}}</p>
                    {% if post.updated_date %}
                        <p class="mr-2">Edited: {{post.updated_date}}</p>
                    {% endif %}
                </div>
            </div>
        {% endfor %}

        {% include "Accounts/pagination.html" with page_obj=posts %}

    </div>
{% endblock %}